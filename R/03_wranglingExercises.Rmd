---
title: "Wrangling data with R"
author: "Juan Antonio Morales"
date: "12 February, 2018"
output: html_document
---

Importing libraries:

```{r libraries, message=F, warning=F}
library(dplyr)
library(quantmod)
library(datasets)
library(nycflights13)
```

1. Taking real data from amazon and google stocks, make an algorithm that perfoms the following: if from one day to another the amazon and google stocks go up, the algorithm will buy the stock that has the higest rise.
_Note_: use `Open` column.

Amazon and Google stocks:
```{r loading data}
amzn <- getSymbols('AMZN', from = "2014-01-01",auto.assign = F)
googl <- getSymbols('GOOGL', from = "2014-01-01",auto.assign = F)
stocks <- cbind(amzn,googl)
```

Algorithm with loops:
```{r ex1}

```



3. For this exercise we will use the `airquality` dataset. Filter the odd days of the month using a function that gives you TRUE if it is an odd day and FALSE if it is an even day.

```{r ex3, warning=F}
str(airquality)
head(airquality)

oddDay = function(day) {
  if (day%%2 != 0) {
    return (TRUE)
  }
  else return (FALSE)
}

airquality %>%
  filter(sapply(Day, oddDay)) %>% head(10)
```

4. Compute the average of each variable per month.

```{r ex4}
airquality %>%
  group_by(Month) %>%
  summarise_all(mean,na.rm=T)
```

5. Take the top 5 origin-destination routes with the highest average delay from `flights` dataset.

```{r ex5}
str(flights)
head(flights)

flights %>%
  group_by(origin,dest) %>%
  summarise(avgDelay = mean(dep_delay+arr_delay,na.rm=T)) %>%
  arrange(desc(avgDelay)) %>% head(5)
```

6. What hour has higest average delays (arrange the dataset from last to greatest)?

```{r ex6}
flights %>%
  group_by(hour) %>%
  summarise(avgDelayPerHour = mean(dep_delay + arr_delay, na.rm = T)) %>%
  arrange(desc(avgDelayPerHour)) %>% head(5)
```

If you only want the number of flights with delay (`dep_delay + arr_delay > 0`) by hour:

```{r ex 6 bis}
flights %>%
  mutate(totalDelay = dep_delay + arr_delay) %>%
  select(hour, totalDelay) %>%
  filter(totalDelay > 0) %>%
  group_by(hour) %>%
  summarise(totalDelays=n()) %>%
  arrange(desc(totalDelays))
```



